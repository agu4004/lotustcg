ğŸ’¡ **Task**
Migrate the existing FlaskÂ 3.11 storefront from inâ€‘memory dictionaries to a persistent PostgreSQL database managed by Replit.

### 1 â–ª Add the database

â€¢ Use the Replit Database tool (PostgreSQL) and let Agent create the instance and store credentials in env vars (`DATABASE_URL`, `PGHOST`, `PGUSER`, `PGPASSWORD`).
â€¢ Install and configure:
â€“ `psycopg2-binary` as the DB driver
â€“ `SQLAlchemy>=2.0` for ORM mapping
â€“ `Flask-SQLAlchemy`Â +Â `Flask-Migrate` for migrations.

### 2 â–ª Define models

â€¢ Convert the current `CARDS` dict into a SQLAlchemy model:

```python
class Card(db.Model):
    __tablename__ = "cards"
    id         = db.Column(db.Integer, primary_key=True)
    name       = db.Column(db.String(120), nullable=False)
    rarity     = db.Column(db.String(20), nullable=False)
    price      = db.Column(db.Numeric(10, 2), nullable=False)
    created_at = db.Column(db.DateTime, server_default=db.func.now())
```

â€¢ Generate the initial migration:

```
flask db init && flask db migrate -m "init tables" && flask db upgrade
```

### 3 â–ª Refactor routes & storage

Replace all direct dictionary reads/writes with ORM queries:

* `CARDS[id]`  â†’ `Card.query.get(id)`
* `CARDS.values()`Â â†’ `Card.query.all()`
* **Add / edit**Â â†’ `db.session.add()` or field assignment + `db.session.commit()`
* **Delete**Â â†’ `db.session.delete()` + `db.session.commit()`

### 4 â–ª Seed & CSV helpers

â€¢ On first run, load any `seed/cards.csv` into the table with `COPY` or SQLAlchemy bulkâ€‘insert.
â€¢ Replace the previous CSV export/import util with databaseâ€‘backed versions (`COPY TO/FROM STDOUT`).

### 5 â–ª Update admin CRUD UI

â€¢ Keep Jinja2 + Bootstrap templates, but fetch data via the new ORMâ€‘powered routes.
â€¢ Maintain role checks (`@admin_required`) so only admins see â€œAddÂ /Â EditÂ /Â Deleteâ€ buttons.

### 6 â–ª Testing & CI

â€¢ Extend the existing pytest suite: add a `postgres` fixture that spins up a transactional test DB per test class and rolls back after each test.
â€¢ Ensure `watch_tests.sh` still runs `pytest --cov=. --maxfail=1` and coverage â‰¥â€¯90â€¯%.

### 7 â–ª Deployment

â€¢ Update Gunicorn command to set `--worker-class gthread` if needed for connection pooling.
â€¢ Document in `README.md` how to:
â€“ View the DB in Replitâ€™s SQL runner
â€“ Run migrations locally and in production
â€“ Restore the DB from the Replit â€œRestoreâ€ tab when required.

ğŸš€ **Acceptance Criteria**

1. All CRUD operations persist across restarts.
2. `pytest -q` passes; `coverage html` shows â‰¥â€¯90â€¯% lines covered.
3. The app deploys via Replit Deployments with no code changes beyond this prompt.
